<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Diary Management System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <style>

        body {
            background-color: #f5f7fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--secondary-color);
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--secondary-color);
            margin-bottom: 1.2rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 8px 20px;
            font-weight: 500;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }

        .btn-danger {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .btn-danger:hover {
            background-color: #c0392b;
            border-color: #c0392b;
        }

        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #27ae60;
            border-color: #27ae60;
        }

        .table {
            margin-top: 20px;
            border-collapse: separate;
            border-spacing: 0;
        }

        .table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            padding: 12px 15px;
        }

        .table td {
            padding: 12px 15px;
            vertical-align: middle;
        }

        .table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .table-hover tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }

        .form-control, .form-select {
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }

        .message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }

        .success-message {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }

        .error-message {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--accent-color);
        }

        .hidden {
            display: none;
        }

        .badge {
            padding: 6px 10px;
            font-weight: 500;
        }

        .badge-present {
            background-color: var(--success-color);
        }

        .badge-absent {
            background-color: var(--accent-color);
        }

        .badge-excused {
            background-color: var(--warning-color);
        }

        .action-buttons .btn {
            margin-right: 5px;
        }

        .nav-tabs .nav-link {
            color: var(--secondary-color);
            font-weight: 500;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            font-weight: 600;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .stat-card h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #666;
            margin-bottom: 0;
        }

        .sidebar {
            background-color: var(--secondary-color);
            color: white;
            min-height: 100vh;
            padding: 20px 0;
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            margin: 5px 0;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .main-content {
            padding: 20px;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box i {
            position: absolute;
            top: 12px;
            left: 15px;
            color: #999;
        }

        .search-box input {
            padding-left: 40px;
        }

        .student-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .card-header {
                padding: 10px 15px;
            }
            
            .table-responsive {
                overflow-x: auto;
            }
        }

        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Navigation -->
            <div class="col-md-3 col-lg-2 d-md-block sidebar bg-dark">
                <div class="position-sticky pt-3">
                    <h4 class="text-center text-white mb-4">
                        <i class="fas fa-book-open me-2"></i>School Diary
                    </h4>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('dashboard-section')">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('attendance-section')">
                                <i class="fas fa-user-check"></i> Attendance
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('grades-section')">
                                <i class="fas fa-graduation-cap"></i> Grades
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('homework-section')">
                                <i class="fas fa-book"></i> Homework
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('classes-section')">
                                <i class="fas fa-users"></i> Classes
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('lessons-section')">
                                <i class="fas fa-chalkboard-teacher"></i> Lessons
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('events-section')">
                                <i class="fas fa-calendar-alt"></i> Events
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('performance-section')">
                                <i class="fas fa-chart-line"></i> Performance
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="col-md-9 col-lg-10 ms-sm-auto main-content">
                <!-- Dashboard Section -->
                <div id="dashboard-section">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Dashboard Overview</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                                <span data-feather="calendar"></span> This week
                            </button>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="stat-card card">
                                <i class="fas fa-user-check"></i>
                                <h3 id="total-students">0</h3>
                                <p>Total Students</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card card">
                                <i class="fas fa-chalkboard-teacher"></i>
                                <h3 id="total-classes">0</h3>
                                <p>Classes</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card card">
                                <i class="fas fa-book"></i>
                                <h3 id="total-subjects">0</h3>
                                <p>Subjects</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card card">
                                <i class="fas fa-calendar-check"></i>
                                <h3 id="upcoming-events">0</h3>
                                <p>Upcoming Events</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-history me-2"></i>Recent Activity</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Activity</th>
                                            <th>Details</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-activity-body">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attendance Section -->
                <div id="attendance-section" class="hidden">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-user-check me-2"></i>Attendance Management</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAttendanceModal">
                            <i class="fas fa-plus me-1"></i> Add Attendance
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>Attendance Records</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="attendance-search" class="form-control" placeholder="Search attendance records..." oninput="filterAttendance()">
                                    </div>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <div class="btn-group">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Filter by Status
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#" onclick="filterAttendanceByStatus('all')">All</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterAttendanceByStatus('Present')">Present</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterAttendanceByStatus('Absent')">Absent</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterAttendanceByStatus('Excused Absence')">Excused Absence</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Student</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="attendance-body">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grades Section -->
                <div id="grades-section" class="hidden">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-graduation-cap me-2"></i>Grade Management</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGradeModal">
                            <i class="fas fa-plus me-1"></i> Add Grade
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>Grade Records</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="grade-search" class="form-control" placeholder="Search grade records..." oninput="filterGrades()">
                                    </div>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <div class="btn-group">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Filter by Subject
                                        </button>
                                        <ul class="dropdown-menu" id="subject-filter-menu">
                                            <!-- Filled by JavaScript -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Student</th>
                                            <th>Subject</th>
                                            <th>Grade</th>
                                            <th>Description</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="grades-body">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Homework Section -->
                <div id="homework-section" class="hidden">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-book me-2"></i>Homework Tracker</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addHomeworkModal">
                            <i class="fas fa-plus me-1"></i> Add Homework
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>Homework Assignments</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="homework-search" class="form-control" placeholder="Search homework..." oninput="filterHomework()">
                                    </div>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <div class="btn-group">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Filter by Subject
                                        </button>
                                        <ul class="dropdown-menu" id="homework-subject-filter-menu">
                                            <!-- Filled by JavaScript -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Due Date</th>
                                            <th>Subject</th>
                                            <th>Description</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="homework-body">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Classes Section -->
                <div id="classes-section" class="hidden">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-users me-2"></i>Class Management</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClassModal">
                            <i class="fas fa-plus me-1"></i> Add Class
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>Class List</h5>
                        </div>
                        <div class="card-body">
                            <div class="search-box mb-3">
                                <i class="fas fa-search"></i>
                                <input type="text" id="class-search" class="form-control" placeholder="Search classes..." oninput="filterClasses()">
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Class Name</th>
                                            <th>Students</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="classes-body">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lessons Section -->
                <div id="lessons-section" class="hidden">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-chalkboard-teacher me-2"></i>Lesson Plans</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addLessonModal">
                            <i class="fas fa-plus me-1"></i> Add Lesson
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>Lesson Plans</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="lesson-search" class="form-control" placeholder="Search lessons..." oninput="filterLessons()">
                                    </div>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <div class="btn-group">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Filter by Subject
                                        </button>
                                        <ul class="dropdown-menu" id="lesson-subject-filter-menu">
                                            <!-- Filled by JavaScript -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Subject</th>
                                            <th>Content</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lessons-body">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Events Section -->
                <div id="events-section" class="hidden">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-calendar-alt me-2"></i>Events Calendar</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEventModal">
                            <i class="fas fa-plus me-1"></i> Add Event
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>Upcoming Events</h5>
                        </div>
                        <div class="card-body">
                            <div class="search-box mb-3">
                                <i class="fas fa-search"></i>
                                <input type="text" id="event-search" class="form-control" placeholder="Search events..." oninput="filterEvents()">
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Title</th>
                                            <th>Description</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="events-body">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Section -->
                <div id="performance-section" class="hidden">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-chart-line me-2"></i>Student Performance</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTestResultModal">
                            <i class="fas fa-plus me-1"></i> Add Test Result
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>Test Results</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="test-search" class="form-control" placeholder="Search test results..." oninput="filterTests()">
                                    </div>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <div class="btn-group">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Filter by Subject
                                        </button>
                                        <ul class="dropdown-menu" id="test-subject-filter-menu">
                                            <!-- Filled by JavaScript -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Student</th>
                                            <th>Subject</th>
                                            <th>Score</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tests-body">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h5>Performance Analytics</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <canvas id="performanceChart" height="300"></canvas>
                                </div>
                                <div class="col-md-6">
                                    <canvas id="subjectComparisonChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Attendance Modal -->
    <div class="modal fade" id="addAttendanceModal" tabindex="-1" aria-labelledby="addAttendanceModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addAttendanceModalLabel">Add Attendance Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addAttendanceForm">
                        <div class="mb-3">
                            <label for="attendance-date" class="form-label">Date</label>
                            <input type="date" class="form-control" id="attendance-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="attendance-student-name" class="form-label">Student Name</label>
                            <input type="text" class="form-control" id="attendance-student-name" list="student-names" required>
                            <datalist id="student-names">
                                <!-- Filled by JavaScript -->
                            </datalist>
                        </div>
                        <div class="mb-3">
                            <label for="attendance-status" class="form-label">Status</label>
                            <select class="form-select" id="attendance-status" required>
                                <option value="Present">Present</option>
                                <option value="Absent">Absent</option>
                                <option value="Excused Absence">Excused Absence</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addAttendance()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Grade Modal -->
    <div class="modal fade" id="addGradeModal" tabindex="-1" aria-labelledby="addGradeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addGradeModalLabel">Add Grade Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addGradeForm">
                        <div class="mb-3">
                            <label for="student-name" class="form-label">Student Name</label>
                            <input type="text" class="form-control" id="student-name" list="student-names" required>
                        </div>
                        <div class="mb-3">
                            <label for="subject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="subject" required>
                        </div>
                        <div class="mb-3">
                            <label for="grade" class="form-label">Grade</label>
                            <input type="number" class="form-control" id="grade" min="1" max="100" required>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <input type="text" class="form-control" id="description">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addGrade()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Homework Modal -->
    <div class="modal fade" id="addHomeworkModal" tabindex="-1" aria-labelledby="addHomeworkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addHomeworkModalLabel">Add Homework Assignment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addHomeworkForm">
                        <div class="mb-3">
                            <label for="homework-date" class="form-label">Due Date</label>
                            <input type="date" class="form-control" id="homework-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="homework-subject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="homework-subject" required>
                        </div>
                        <div class="mb-3">
                            <label for="homework-description" class="form-label">Description</label>
                            <textarea class="form-control" id="homework-description" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addHomework()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div class="modal fade" id="addClassModal" tabindex="-1" aria-labelledby="addClassModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addClassModalLabel">Add New Class</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addClassForm">
                        <div class="mb-3">
                            <label for="class-name" class="form-label">Class Name</label>
                            <input type="text" class="form-control" id="class-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="class-students" class="form-label">Students (comma separated)</label>
                            <textarea class="form-control" id="class-students" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addClass()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Lesson Modal -->
    <div class="modal fade" id="addLessonModal" tabindex="-1" aria-labelledby="addLessonModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addLessonModalLabel">Add Lesson Plan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addLessonForm">
                        <div class="mb-3">
                            <label for="lesson-date" class="form-label">Date</label>
                            <input type="date" class="form-control" id="lesson-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="lesson-subject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="lesson-subject" required>
                        </div>
                        <div class="mb-3">
                            <label for="lesson-content" class="form-label">Content</label>
                            <textarea class="form-control" id="lesson-content" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addLesson()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEventModalLabel">Add New Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addEventForm">
                        <div class="mb-3">
                            <label for="event-date" class="form-label">Date</label>
                            <input type="date" class="form-control" id="event-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="event-title" class="form-label">Title</label>
                            <input type="text" class="form-control" id="event-title" required>
                        </div>
                        <div class="mb-3">
                            <label for="event-description" class="form-label">Description</label>
                            <textarea class="form-control" id="event-description" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addEvent()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Test Result Modal -->
    <div class="modal fade" id="addTestResultModal" tabindex="-1" aria-labelledby="addTestResultModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addTestResultModalLabel">Add Test Result</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addTestResultForm">
                        <div class="mb-3">
                            <label for="test-date" class="form-label">Date</label>
                            <input type="date" class="form-control" id="test-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="test-student-name" class="form-label">Student Name</label>
                            <input type="text" class="form-control" id="test-student-name" list="student-names" required>
                        </div>
                        <div class="mb-3">
                            <label for="test-subject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="test-subject" required>
                        </div>
                        <div class="mb-3">
                            <label for="test-score" class="form-label">Score</label>
                            <input type="number" class="form-control" id="test-score" min="0" max="100" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addTestResult()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal (Generic) -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="editModalBody">
                    <!-- Content will be dynamically inserted here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEditButton">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this record? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom JavaScript -->
    <script>
        // Data storage and initialization
        const storageKeys = {
            ATTENDANCE: 'attendance_records',
            GRADES: 'grade_records',
            HOMEWORK: 'homework_records',
            CLASSES: 'class_records',
            LESSONS: 'lesson_records',
            EVENTS: 'event_records',
            TESTS: 'test_records',
            ACTIVITY: 'activity_log'
        };

        let attendanceRecords = JSON.parse(localStorage.getItem(storageKeys.ATTENDANCE)) || [];
        let gradeRecords = JSON.parse(localStorage.getItem(storageKeys.GRADES)) || [];
        let homeworkRecords = JSON.parse(localStorage.getItem(storageKeys.HOMEWORK)) || [];
        let classRecords = JSON.parse(localStorage.getItem(storageKeys.CLASSES)) || [];
        let lessonRecords = JSON.parse(localStorage.getItem(storageKeys.LESSONS)) || [];
        let eventRecords = JSON.parse(localStorage.getItem(storageKeys.EVENTS)) || [];
        let testRecords = JSON.parse(localStorage.getItem(storageKeys.TESTS)) || [];
        let activityLog = JSON.parse(localStorage.getItem(storageKeys.ACTIVITY)) || [];

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the application
            initApplication();
            
            // Show dashboard by default
            showSection('dashboard-section');
            
            // Initialize charts
            initCharts();
        });

        // Initialize the application
        function initApplication() {
            // Populate all sections
            populateAttendance();
            populateGrades();
            populateHomework();
            populateClasses();
            populateLessons();
            populateEvents();
            populateTests();
            populateRecentActivity();
            updateDashboardStats();
            
            // Initialize student names datalist
            updateStudentNamesDatalist();
            
            // Initialize filter menus
            updateFilterMenus();
        }

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.main-content > div').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show the selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update active nav link
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find the corresponding nav link and activate it
            const navLinks = {
                'dashboard-section': 'Dashboard',
                'attendance-section': 'Attendance',
                'grades-section': 'Grades',
                'homework-section': 'Homework',
                'classes-section': 'Classes',
                'lessons-section': 'Lessons',
                'events-section': 'Events',
                'performance-section': 'Performance'
            };
            
            const sectionName = navLinks[sectionId];
            if (sectionName) {
                const navItem = Array.from(document.querySelectorAll('.sidebar .nav-link')).find(link => 
                    link.textContent.includes(sectionName)
                );
                if (navItem) {
                    navItem.classList.add('active');
                }
            }
            
            // Refresh charts if showing performance section
            if (sectionId === 'performance-section') {
                initCharts();
            }
        }

        // Data manipulation functions
        function addAttendance() {
            const date = document.getElementById('attendance-date').value;
            const studentName = document.getElementById('attendance-student-name').value;
            const status = document.getElementById('attendance-status').value;
            
            if (!date || !studentName) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }
            
            attendanceRecords.push({ date, studentName, status });
            saveData(storageKeys.ATTENDANCE, attendanceRecords);
            
            // Add to activity log
            logActivity(`Added attendance for ${studentName} (${status})`);
            
            // Close modal and refresh
            bootstrap.Modal.getInstance(document.getElementById('addAttendanceModal')).hide();
            populateAttendance();
            updateDashboardStats();
            updateStudentNamesDatalist();
            
            showMessage('Attendance record added successfully!', 'success');
        }

        function editAttendance(index) {
            const record = attendanceRecords[index];
            const modalBody = document.getElementById('editModalBody');
            
            modalBody.innerHTML = `
                <form id="editAttendanceForm">
                    <div class="mb-3">
                        <label for="edit-attendance-date" class="form-label">Date</label>
                        <input type="date" class="form-control" id="edit-attendance-date" value="${record.date}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-attendance-student-name" class="form-label">Student Name</label>
                        <input type="text" class="form-control" id="edit-attendance-student-name" value="${record.studentName}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-attendance-status" class="form-label">Status</label>
                        <select class="form-select" id="edit-attendance-status" required>
                            <option value="Present" ${record.status === 'Present' ? 'selected' : ''}>Present</option>
                            <option value="Absent" ${record.status === 'Absent' ? 'selected' : ''}>Absent</option>
                            <option value="Excused Absence" ${record.status === 'Excused Absence' ? 'selected' : ''}>Excused Absence</option>
                        </select>
                    </div>
                </form>
            `;
            
            // Set up save button
            document.getElementById('saveEditButton').onclick = function() {
                const newDate = document.getElementById('edit-attendance-date').value;
                const newStudentName = document.getElementById('edit-attendance-student-name').value;
                const newStatus = document.getElementById('edit-attendance-status').value;
                
                if (!newDate || !newStudentName) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Update record
                attendanceRecords[index] = { date: newDate, studentName: newStudentName, status: newStatus };
                saveData(storageKeys.ATTENDANCE, attendanceRecords);
                
                // Add to activity log
                logActivity(`Updated attendance for ${newStudentName}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                populateAttendance();
                updateDashboardStats();
                updateStudentNamesDatalist();
                
                showMessage('Attendance record updated successfully!', 'success');
            };
            
            // Show modal
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }

        function deleteAttendance(index) {
            const record = attendanceRecords[index];
            
            // Set up confirmation button
            document.getElementById('confirmDeleteButton').onclick = function() {
                attendanceRecords.splice(index, 1);
                saveData(storageKeys.ATTENDANCE, attendanceRecords);
                
                // Add to activity log
                logActivity(`Deleted attendance for ${record.studentName}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('confirmationModal')).hide();
                populateAttendance();
                updateDashboardStats();
                updateStudentNamesDatalist();
                
                showMessage('Attendance record deleted successfully!', 'success');
            };
            
            // Show confirmation modal
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        }

        function addGrade() {
            const studentName = document.getElementById('student-name').value;
            const subject = document.getElementById('subject').value;
            const grade = document.getElementById('grade').value;
            const description = document.getElementById('description').value;
            
            if (!studentName || !subject || !grade) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }
            
            gradeRecords.push({ studentName, subject, grade, description });
            saveData(storageKeys.GRADES, gradeRecords);
            
            // Add to activity log
            logActivity(`Added grade for ${studentName} in ${subject}`);
            
            // Close modal and refresh
            bootstrap.Modal.getInstance(document.getElementById('addGradeModal')).hide();
            populateGrades();
            updateDashboardStats();
            updateStudentNamesDatalist();
            updateFilterMenus();
            
            showMessage('Grade record added successfully!', 'success');
        }

        function editGrade(index) {
            const record = gradeRecords[index];
            const modalBody = document.getElementById('editModalBody');
            
            modalBody.innerHTML = `
                <form id="editGradeForm">
                    <div class="mb-3">
                        <label for="edit-student-name" class="form-label">Student Name</label>
                        <input type="text" class="form-control" id="edit-student-name" value="${record.studentName}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="edit-subject" value="${record.subject}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-grade" class="form-label">Grade</label>
                        <input type="number" class="form-control" id="edit-grade" value="${record.grade}" min="1" max="100" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-description" class="form-label">Description</label>
                        <input type="text" class="form-control" id="edit-description" value="${record.description || ''}">
                    </div>
                </form>
            `;
            
            // Set up save button
            document.getElementById('saveEditButton').onclick = function() {
                const newStudentName = document.getElementById('edit-student-name').value;
                const newSubject = document.getElementById('edit-subject').value;
                const newGrade = document.getElementById('edit-grade').value;
                const newDescription = document.getElementById('edit-description').value;
                
                if (!newStudentName || !newSubject || !newGrade) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Update record
                gradeRecords[index] = { studentName: newStudentName, subject: newSubject, grade: newGrade, description: newDescription };
                saveData(storageKeys.GRADES, gradeRecords);
                
                // Add to activity log
                logActivity(`Updated grade for ${newStudentName} in ${newSubject}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                populateGrades();
                updateDashboardStats();
                updateStudentNamesDatalist();
                updateFilterMenus();
                
                showMessage('Grade record updated successfully!', 'success');
            };
            
            // Show modal
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }

        function deleteGrade(index) {
            const record = gradeRecords[index];
            
            // Set up confirmation button
            document.getElementById('confirmDeleteButton').onclick = function() {
                gradeRecords.splice(index, 1);
                saveData(storageKeys.GRADES, gradeRecords);
                
                // Add to activity log
                logActivity(`Deleted grade for ${record.studentName} in ${record.subject}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('confirmationModal')).hide();
                populateGrades();
                updateDashboardStats();
                updateStudentNamesDatalist();
                updateFilterMenus();
                
                showMessage('Grade record deleted successfully!', 'success');
            };
            
            // Show confirmation modal
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        }

        function addHomework() {
            const date = document.getElementById('homework-date').value;
            const subject = document.getElementById('homework-subject').value;
            const description = document.getElementById('homework-description').value;
            
            if (!date || !subject) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }
            
            homeworkRecords.push({ date, subject, description });
            saveData(storageKeys.HOMEWORK, homeworkRecords);
            
            // Add to activity log
            logActivity(`Added homework for ${subject}`);
            
            // Close modal and refresh
            bootstrap.Modal.getInstance(document.getElementById('addHomeworkModal')).hide();
            populateHomework();
            updateDashboardStats();
            updateFilterMenus();
            
            showMessage('Homework assignment added successfully!', 'success');
        }

        function editHomework(index) {
            const record = homeworkRecords[index];
            const modalBody = document.getElementById('editModalBody');
            
            modalBody.innerHTML = `
                <form id="editHomeworkForm">
                    <div class="mb-3">
                        <label for="edit-homework-date" class="form-label">Due Date</label>
                        <input type="date" class="form-control" id="edit-homework-date" value="${record.date}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-homework-subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="edit-homework-subject" value="${record.subject}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-homework-description" class="form-label">Description</label>
                        <textarea class="form-control" id="edit-homework-description" rows="3">${record.description || ''}</textarea>
                    </div>
                </form>
            `;
            
            // Set up save button
            document.getElementById('saveEditButton').onclick = function() {
                const newDate = document.getElementById('edit-homework-date').value;
                const newSubject = document.getElementById('edit-homework-subject').value;
                const newDescription = document.getElementById('edit-homework-description').value;
                
                if (!newDate || !newSubject) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Update record
                homeworkRecords[index] = { date: newDate, subject: newSubject, description: newDescription };
                saveData(storageKeys.HOMEWORK, homeworkRecords);
                
                // Add to activity log
                logActivity(`Updated homework for ${newSubject}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                populateHomework();
                updateDashboardStats();
                updateFilterMenus();
                
                showMessage('Homework assignment updated successfully!', 'success');
            };
            
            // Show modal
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }

        function deleteHomework(index) {
            const record = homeworkRecords[index];
            
            // Set up confirmation button
            document.getElementById('confirmDeleteButton').onclick = function() {
                homeworkRecords.splice(index, 1);
                saveData(storageKeys.HOMEWORK, homeworkRecords);
                
                // Add to activity log
                logActivity(`Deleted homework for ${record.subject}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('confirmationModal')).hide();
                populateHomework();
                updateDashboardStats();
                updateFilterMenus();
                
                showMessage('Homework assignment deleted successfully!', 'success');
            };
            
            // Show confirmation modal
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        }

        function addClass() {
            const className = document.getElementById('class-name').value;
            const students = document.getElementById('class-students').value.split(',').map(s => s.trim()).filter(s => s);
            
            if (!className || students.length === 0) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }
            
            classRecords.push({ className, students });
            saveData(storageKeys.CLASSES, classRecords);
            
            // Add to activity log
            logActivity(`Added class ${className} with ${students.length} students`);
            
            // Close modal and refresh
            bootstrap.Modal.getInstance(document.getElementById('addClassModal')).hide();
            populateClasses();
            updateDashboardStats();
            updateStudentNamesDatalist();
            updateFilterMenus();
            
            showMessage('Class added successfully!', 'success');
        }

        function editClass(index) {
            const record = classRecords[index];
            const modalBody = document.getElementById('editModalBody');
            
            modalBody.innerHTML = `
                <form id="editClassForm">
                    <div class="mb-3">
                        <label for="edit-class-name" class="form-label">Class Name</label>
                        <input type="text" class="form-control" id="edit-class-name" value="${record.className}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-class-students" class="form-label">Students (comma separated)</label>
                        <textarea class="form-control" id="edit-class-students" rows="3" required>${record.students.join(', ')}</textarea>
                    </div>
                </form>
            `;
            
            // Set up save button
            document.getElementById('saveEditButton').onclick = function() {
                const newClassName = document.getElementById('edit-class-name').value;
                const newStudents = document.getElementById('edit-class-students').value.split(',').map(s => s.trim()).filter(s => s);
                
                if (!newClassName || newStudents.length === 0) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Update record
                classRecords[index] = { className: newClassName, students: newStudents };
                saveData(storageKeys.CLASSES, classRecords);
                
                // Add to activity log
                logActivity(`Updated class ${newClassName}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                populateClasses();
                updateDashboardStats();
                updateStudentNamesDatalist();
                updateFilterMenus();
                
                showMessage('Class updated successfully!', 'success');
            };
            
            // Show modal
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }

        function deleteClass(index) {
            const record = classRecords[index];
            
            // Set up confirmation button
            document.getElementById('confirmDeleteButton').onclick = function() {
                classRecords.splice(index, 1);
                saveData(storageKeys.CLASSES, classRecords);
                
                // Add to activity log
                logActivity(`Deleted class ${record.className}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('confirmationModal')).hide();
                populateClasses();
                updateDashboardStats();
                updateStudentNamesDatalist();
                updateFilterMenus();
                
                showMessage('Class deleted successfully!', 'success');
            };
            
            // Show confirmation modal
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        }

        function addLesson() {
            const date = document.getElementById('lesson-date').value;
            const subject = document.getElementById('lesson-subject').value;
            const content = document.getElementById('lesson-content').value;
            
            if (!date || !subject) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }
            
            lessonRecords.push({ date, subject, content });
            saveData(storageKeys.LESSONS, lessonRecords);
            
            // Add to activity log
            logActivity(`Added lesson for ${subject}`);
            
            // Close modal and refresh
            bootstrap.Modal.getInstance(document.getElementById('addLessonModal')).hide();
            populateLessons();
            updateDashboardStats();
            updateFilterMenus();
            
            showMessage('Lesson plan added successfully!', 'success');
        }

        function editLesson(index) {
            const record = lessonRecords[index];
            const modalBody = document.getElementById('editModalBody');
            
            modalBody.innerHTML = `
                <form id="editLessonForm">
                    <div class="mb-3">
                        <label for="edit-lesson-date" class="form-label">Date</label>
                        <input type="date" class="form-control" id="edit-lesson-date" value="${record.date}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-lesson-subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="edit-lesson-subject" value="${record.subject}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-lesson-content" class="form-label">Content</label>
                        <textarea class="form-control" id="edit-lesson-content" rows="3">${record.content || ''}</textarea>
                    </div>
                </form>
            `;
            
            // Set up save button
            document.getElementById('saveEditButton').onclick = function() {
                const newDate = document.getElementById('edit-lesson-date').value;
                const newSubject = document.getElementById('edit-lesson-subject').value;
                const newContent = document.getElementById('edit-lesson-content').value;
                
                if (!newDate || !newSubject) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Update record
                lessonRecords[index] = { date: newDate, subject: newSubject, content: newContent };
                saveData(storageKeys.LESSONS, lessonRecords);
                
                // Add to activity log
                logActivity(`Updated lesson for ${newSubject}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                populateLessons();
                updateDashboardStats();
                updateFilterMenus();
                
                showMessage('Lesson plan updated successfully!', 'success');
            };
            
            // Show modal
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }

        function deleteLesson(index) {
            const record = lessonRecords[index];
            
            // Set up confirmation button
            document.getElementById('confirmDeleteButton').onclick = function() {
                lessonRecords.splice(index, 1);
                saveData(storageKeys.LESSONS, lessonRecords);
                
                // Add to activity log
                logActivity(`Deleted lesson for ${record.subject}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('confirmationModal')).hide();
                populateLessons();
                updateDashboardStats();
                updateFilterMenus();
                
                showMessage('Lesson plan deleted successfully!', 'success');
            };
            
            // Show confirmation modal
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        }

        function addEvent() {
            const date = document.getElementById('event-date').value;
            const title = document.getElementById('event-title').value;
            const description = document.getElementById('event-description').value;
            
            if (!date || !title) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }
            
            eventRecords.push({ date, title, description });
            saveData(storageKeys.EVENTS, eventRecords);
            
            // Add to activity log
            logActivity(`Added event: ${title}`);
            
            // Close modal and refresh
            bootstrap.Modal.getInstance(document.getElementById('addEventModal')).hide();
            populateEvents();
            updateDashboardStats();
            
            showMessage('Event added successfully!', 'success');
        }

        function editEvent(index) {
            const record = eventRecords[index];
            const modalBody = document.getElementById('editModalBody');
            
            modalBody.innerHTML = `
                <form id="editEventForm">
                    <div class="mb-3">
                        <label for="edit-event-date" class="form-label">Date</label>
                        <input type="date" class="form-control" id="edit-event-date" value="${record.date}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-event-title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="edit-event-title" value="${record.title}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-event-description" class="form-label">Description</label>
                        <textarea class="form-control" id="edit-event-description" rows="3">${record.description || ''}</textarea>
                    </div>
                </form>
            `;
            
            // Set up save button
            document.getElementById('saveEditButton').onclick = function() {
                const newDate = document.getElementById('edit-event-date').value;
                const newTitle = document.getElementById('edit-event-title').value;
                const newDescription = document.getElementById('edit-event-description').value;
                
                if (!newDate || !newTitle) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Update record
                eventRecords[index] = { date: newDate, title: newTitle, description: newDescription };
                saveData(storageKeys.EVENTS, eventRecords);
                
                // Add to activity log
                logActivity(`Updated event: ${newTitle}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                populateEvents();
                updateDashboardStats();
                
                showMessage('Event updated successfully!', 'success');
            };
            
            // Show modal
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }

        function deleteEvent(index) {
            const record = eventRecords[index];
            
            // Set up confirmation button
            document.getElementById('confirmDeleteButton').onclick = function() {
                eventRecords.splice(index, 1);
                saveData(storageKeys.EVENTS, eventRecords);
                
                // Add to activity log
                logActivity(`Deleted event: ${record.title}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('confirmationModal')).hide();
                populateEvents();
                updateDashboardStats();
                
                showMessage('Event deleted successfully!', 'success');
            };
            
            // Show confirmation modal
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        }

        function addTestResult() {
            const date = document.getElementById('test-date').value;
            const studentName = document.getElementById('test-student-name').value;
            const subject = document.getElementById('test-subject').value;
            const score = document.getElementById('test-score').value;
            
            if (!date || !studentName || !subject || !score) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }
            
            testRecords.push({ date, studentName, subject, score });
            saveData(storageKeys.TESTS, testRecords);
            
            // Add to activity log
            logActivity(`Added test result for ${studentName} in ${subject}`);
            
            // Close modal and refresh
            bootstrap.Modal.getInstance(document.getElementById('addTestResultModal')).hide();
            populateTests();
            updateDashboardStats();
            updateStudentNamesDatalist();
            updateFilterMenus();
            
            showMessage('Test result added successfully!', 'success');
        }

        function editTestResult(index) {
            const record = testRecords[index];
            const modalBody = document.getElementById('editModalBody');
            
            modalBody.innerHTML = `
                <form id="editTestResultForm">
                    <div class="mb-3">
                        <label for="edit-test-date" class="form-label">Date</label>
                        <input type="date" class="form-control" id="edit-test-date" value="${record.date}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-test-student-name" class="form-label">Student Name</label>
                        <input type="text" class="form-control" id="edit-test-student-name" value="${record.studentName}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-test-subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="edit-test-subject" value="${record.subject}" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-test-score" class="form-label">Score</label>
                        <input type="number" class="form-control" id="edit-test-score" value="${record.score}" min="0" max="100" required>
                    </div>
                </form>
            `;
            
            // Set up save button
            document.getElementById('saveEditButton').onclick = function() {
                const newDate = document.getElementById('edit-test-date').value;
                const newStudentName = document.getElementById('edit-test-student-name').value;
                const newSubject = document.getElementById('edit-test-subject').value;
                const newScore = document.getElementById('edit-test-score').value;
                
                if (!newDate || !newStudentName || !newSubject || !newScore) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Update record
                testRecords[index] = { date: newDate, studentName: newStudentName, subject: newSubject, score: newScore };
                saveData(storageKeys.TESTS, testRecords);
                
                // Add to activity log
                logActivity(`Updated test result for ${newStudentName} in ${newSubject}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                populateTests();
                updateDashboardStats();
                updateStudentNamesDatalist();
                updateFilterMenus();
                
                showMessage('Test result updated successfully!', 'success');
            };
            
            // Show modal
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }

        function deleteTestResult(index) {
            const record = testRecords[index];
            
            // Set up confirmation button
            document.getElementById('confirmDeleteButton').onclick = function() {
                testRecords.splice(index, 1);
                saveData(storageKeys.TESTS, testRecords);
                
                // Add to activity log
                logActivity(`Deleted test result for ${record.studentName} in ${record.subject}`);
                
                // Close modal and refresh
                bootstrap.Modal.getInstance(document.getElementById('confirmationModal')).hide();
                populateTests();
                updateDashboardStats();
                updateStudentNamesDatalist();
                updateFilterMenus();
                
                showMessage('Test result deleted successfully!', 'success');
            };
            
            // Show confirmation modal
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        }

        // Data display functions
        function populateAttendance() {
            const attendanceBody = document.getElementById('attendance-body');
            attendanceBody.innerHTML = '';
            
            attendanceRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'slide-up';
                
                // Determine badge class based on status
                let badgeClass = '';
                if (record.status === 'Present') badgeClass = 'badge-present';
                else if (record.status === 'Absent') badgeClass = 'badge-absent';
                else if (record.status === 'Excused Absence') badgeClass = 'badge-excused';
                
                row.innerHTML = `
                    <td>${formatDate(record.date)}</td>
                    <td>
                        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(record.studentName)}&background=random" class="student-avatar">
                        ${record.studentName}
                    </td>
                    <td><span class="badge ${badgeClass}">${record.status}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editAttendance(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteAttendance(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                attendanceBody.appendChild(row);
            });
        }

        function populateGrades() {
            const gradesBody = document.getElementById('grades-body');
            gradesBody.innerHTML = '';
            
            gradeRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'slide-up';
                
                row.innerHTML = `
                    <td>
                        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(record.studentName)}&background=random" class="student-avatar">
                        ${record.studentName}
                    </td>
                    <td>${record.subject}</td>
                    <td>${record.grade}</td>
                    <td>${record.description || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editGrade(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteGrade(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                gradesBody.appendChild(row);
            });
        }

        function populateHomework() {
            const homeworkBody = document.getElementById('homework-body');
            homeworkBody.innerHTML = '';
            
            homeworkRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'slide-up';
                
                row.innerHTML = `
                    <td>${formatDate(record.date)}</td>
                    <td>${record.subject}</td>
                    <td>${record.description || '-'}</td>
                    <td><span class="badge bg-info">Pending</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editHomework(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteHomework(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                homeworkBody.appendChild(row);
            });
        }

        function populateClasses() {
            const classesBody = document.getElementById('classes-body');
            classesBody.innerHTML = '';
            
            classRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'slide-up';
                
                row.innerHTML = `
                    <td>${record.className}</td>
                    <td>
                        <div class="d-flex flex-wrap gap-1">
                            ${record.students.map(student => `
                                <span class="badge bg-primary">${student}</span>
                            `).join('')}
                        </div>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editClass(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteClass(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                classesBody.appendChild(row);
            });
        }

        function populateLessons() {
            const lessonsBody = document.getElementById('lessons-body');
            lessonsBody.innerHTML = '';
            
            lessonRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'slide-up';
                
                row.innerHTML = `
                    <td>${formatDate(record.date)}</td>
                    <td>${record.subject}</td>
                    <td>${record.content || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editLesson(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteLesson(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                lessonsBody.appendChild(row);
            });
        }

        function populateEvents() {
            const eventsBody = document.getElementById('events-body');
            eventsBody.innerHTML = '';
            
            // Sort events by date (ascending)
            const sortedEvents = [...eventRecords].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            sortedEvents.forEach((record, index) => {
                const originalIndex = eventRecords.findIndex(r => 
                    r.date === record.date && 
                    r.title === record.title && 
                    r.description === record.description
                );
                
                const row = document.createElement('tr');
                row.className = 'slide-up';
                
                row.innerHTML = `
                    <td>${formatDate(record.date)}</td>
                    <td>${record.title}</td>
                    <td>${record.description || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editEvent(${originalIndex})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteEvent(${originalIndex})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                eventsBody.appendChild(row);
            });
        }

        function populateTests() {
            const testsBody = document.getElementById('tests-body');
            testsBody.innerHTML = '';
            
            testRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'slide-up';
                
                row.innerHTML = `
                    <td>${formatDate(record.date)}</td>
                    <td>
                        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(record.studentName)}&background=random" class="student-avatar">
                        ${record.studentName}
                    </td>
                    <td>${record.subject}</td>
                    <td>${record.score}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editTestResult(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTestResult(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                testsBody.appendChild(row);
            });
        }

        function populateRecentActivity() {
            const activityBody = document.getElementById('recent-activity-body');
            activityBody.innerHTML = '';
            
            // Sort activity by timestamp (descending) and get last 10
            const sortedActivity = [...activityLog]
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 10);
            
            sortedActivity.forEach(activity => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                
                row.innerHTML = `
                    <td>${formatDateTime(activity.timestamp)}</td>
                    <td>${activity.action}</td>
                    <td>${activity.details || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </td>
                `;
                
                activityBody.appendChild(row);
            });
        }

        // Filtering functions
        function filterAttendance() {
            const searchTerm = document.getElementById('attendance-search').value.toLowerCase();
            const rows = document.querySelectorAll('#attendance-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterAttendanceByStatus(status) {
            const rows = document.querySelectorAll('#attendance-body tr');
            
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    const statusCell = row.querySelector('td:nth-child(3)');
                    if (statusCell && statusCell.textContent.includes(status)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        function filterGrades() {
            const searchTerm = document.getElementById('grade-search').value.toLowerCase();
            const rows = document.querySelectorAll('#grades-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterGradesBySubject(subject) {
            const rows = document.querySelectorAll('#grades-body tr');
            
            rows.forEach(row => {
                if (subject === 'all') {
                    row.style.display = '';
                } else {
                    const subjectCell = row.querySelector('td:nth-child(2)');
                    if (subjectCell && subjectCell.textContent.includes(subject)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        function filterHomework() {
            const searchTerm = document.getElementById('homework-search').value.toLowerCase();
            const rows = document.querySelectorAll('#homework-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterHomeworkBySubject(subject) {
            const rows = document.querySelectorAll('#homework-body tr');
            
            rows.forEach(row => {
                if (subject === 'all') {
                    row.style.display = '';
                } else {
                    const subjectCell = row.querySelector('td:nth-child(2)');
                    if (subjectCell && subjectCell.textContent.includes(subject)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        function filterClasses() {
            const searchTerm = document.getElementById('class-search').value.toLowerCase();
            const rows = document.querySelectorAll('#classes-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterLessons() {
            const searchTerm = document.getElementById('lesson-search').value.toLowerCase();
            const rows = document.querySelectorAll('#lessons-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterLessonsBySubject(subject) {
            const rows = document.querySelectorAll('#lessons-body tr');
            
            rows.forEach(row => {
                if (subject === 'all') {
                    row.style.display = '';
                } else {
                    const subjectCell = row.querySelector('td:nth-child(2)');
                    if (subjectCell && subjectCell.textContent.includes(subject)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        function filterEvents() {
            const searchTerm = document.getElementById('event-search').value.toLowerCase();
            const rows = document.querySelectorAll('#events-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterTests() {
            const searchTerm = document.getElementById('test-search').value.toLowerCase();
            const rows = document.querySelectorAll('#tests-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterTestsBySubject(subject) {
            const rows = document.querySelectorAll('#tests-body tr');
            
            rows.forEach(row => {
                if (subject === 'all') {
                    row.style.display = '';
                } else {
                    const subjectCell = row.querySelector('td:nth-child(3)');
                    if (subjectCell && subjectCell.textContent.includes(subject)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        // Utility functions
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function logActivity(action, details = '') {
            const timestamp = new Date().toISOString();
            activityLog.push({ timestamp, action, details });
            saveData(storageKeys.ACTIVITY, activityLog);
            
            // Update recent activity if on dashboard
            if (!document.getElementById('dashboard-section').classList.contains('hidden')) {
                populateRecentActivity();
            }
        }

        function showMessage(message, type = 'success') {
            // Create message element
            const messageElement = document.createElement('div');
            messageElement.className = `alert alert-${type} fade-in position-fixed top-0 end-0 m-3`;
            messageElement.style.zIndex = '1100';
            messageElement.style.maxWidth = '400px';
            messageElement.textContent = message;
            
            // Add to body
            document.body.appendChild(messageElement);
            
            // Remove after 3 seconds
            setTimeout(() => {
                messageElement.classList.add('fade-out');
                setTimeout(() => messageElement.remove(), 300);
            }, 3000);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '';
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateTimeString).toLocaleDateString(undefined, options);
        }

        function updateDashboardStats() {
            // Total students (unique names from all sources)
            const allStudents = new Set();
            
            // From attendance
            attendanceRecords.forEach(record => allStudents.add(record.studentName));
            
            // From grades
            gradeRecords.forEach(record => allStudents.add(record.studentName));
            
            // From tests
            testRecords.forEach(record => allStudents.add(record.studentName));
            
            // From classes
            classRecords.forEach(record => {
                record.students.forEach(student => allStudents.add(student));
            });
            
            document.getElementById('total-students').textContent = allStudents.size;
            
            // Total classes
            document.getElementById('total-classes').textContent = classRecords.length;
            
            // Total subjects (unique from grades, homework, lessons, tests)
            const allSubjects = new Set();
            
            gradeRecords.forEach(record => allSubjects.add(record.subject));
            homeworkRecords.forEach(record => allSubjects.add(record.subject));
            lessonRecords.forEach(record => allSubjects.add(record.subject));
            testRecords.forEach(record => allSubjects.add(record.subject));
            
            document.getElementById('total-subjects').textContent = allSubjects.size;
            
            // Upcoming events (events with date >= today)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const upcomingEvents = eventRecords.filter(event => {
                const eventDate = new Date(event.date);
                eventDate.setHours(0, 0, 0, 0);
                return eventDate >= today;
            });
            
            document.getElementById('upcoming-events').textContent = upcomingEvents.length;
        }

        function updateStudentNamesDatalist() {
            const datalist = document.getElementById('student-names');
            datalist.innerHTML = '';
            
            // Get unique student names from all sources
            const allStudents = new Set();
            
            // From attendance
            attendanceRecords.forEach(record => allStudents.add(record.studentName));
            
            // From grades
            gradeRecords.forEach(record => allStudents.add(record.studentName));
            
            // From tests
            testRecords.forEach(record => allStudents.add(record.studentName));
            
            // From classes
            classRecords.forEach(record => {
                record.students.forEach(student => allStudents.add(student));
            });
            
            // Add options to datalist
            allStudents.forEach(student => {
                const option = document.createElement('option');
                option.value = student;
                datalist.appendChild(option);
            });
        }

        function updateFilterMenus() {
            // Update subject filter for grades
            const gradeSubjectMenu = document.getElementById('subject-filter-menu');
            gradeSubjectMenu.innerHTML = '';
            
            const gradeSubjects = new Set();
            gradeRecords.forEach(record => gradeSubjects.add(record.subject));
            
            // Add "All" option
            const allOption = document.createElement('li');
            allOption.innerHTML = '<a class="dropdown-item" href="#" onclick="filterGradesBySubject(\'all\')">All Subjects</a>';
            gradeSubjectMenu.appendChild(allOption);
            
            // Add divider
            const divider = document.createElement('li');
            divider.innerHTML = '<hr class="dropdown-divider">';
            gradeSubjectMenu.appendChild(divider);
            
            // Add subjects
            gradeSubjects.forEach(subject => {
                const item = document.createElement('li');
                item.innerHTML = `<a class="dropdown-item" href="#" onclick="filterGradesBySubject('${subject}')">${subject}</a>`;
                gradeSubjectMenu.appendChild(item);
            });
            
            // Update subject filter for homework
            const homeworkSubjectMenu = document.getElementById('homework-subject-filter-menu');
            homeworkSubjectMenu.innerHTML = '';
            
            const homeworkSubjects = new Set();
            homeworkRecords.forEach(record => homeworkSubjects.add(record.subject));
            
            // Add "All" option
            const allHomeworkOption = document.createElement('li');
            allHomeworkOption.innerHTML = '<a class="dropdown-item" href="#" onclick="filterHomeworkBySubject(\'all\')">All Subjects</a>';
            homeworkSubjectMenu.appendChild(allHomeworkOption);
            
            // Add divider
            const homeworkDivider = document.createElement('li');
            homeworkDivider.innerHTML = '<hr class="dropdown-divider">';
            homeworkSubjectMenu.appendChild(homeworkDivider);
            
            // Add subjects
            homeworkSubjects.forEach(subject => {
                const item = document.createElement('li');
                item.innerHTML = `<a class="dropdown-item" href="#" onclick="filterHomeworkBySubject('${subject}')">${subject}</a>`;
                homeworkSubjectMenu.appendChild(item);
            });
            
            // Update subject filter for lessons
            const lessonSubjectMenu = document.getElementById('lesson-subject-filter-menu');
            lessonSubjectMenu.innerHTML = '';
            
            const lessonSubjects = new Set();
            lessonRecords.forEach(record => lessonSubjects.add(record.subject));
            
            // Add "All" option
            const allLessonOption = document.createElement('li');
            allLessonOption.innerHTML = '<a class="dropdown-item" href="#" onclick="filterLessonsBySubject(\'all\')">All Subjects</a>';
            lessonSubjectMenu.appendChild(allLessonOption);
            
            // Add divider
            const lessonDivider = document.createElement('li');
            lessonDivider.innerHTML = '<hr class="dropdown-divider">';
            lessonSubjectMenu.appendChild(lessonDivider);
            
            // Add subjects
            lessonSubjects.forEach(subject => {
                const item = document.createElement('li');
                item.innerHTML = `<a class="dropdown-item" href="#" onclick="filterLessonsBySubject('${subject}')">${subject}</a>`;
                lessonSubjectMenu.appendChild(item);
            });
            
            // Update subject filter for tests
            const testSubjectMenu = document.getElementById('test-subject-filter-menu');
            testSubjectMenu.innerHTML = '';
            
            const testSubjects = new Set();
            testRecords.forEach(record => testSubjects.add(record.subject));
            
            // Add "All" option
            const allTestOption = document.createElement('li');
            allTestOption.innerHTML = '<a class="dropdown-item" href="#" onclick="filterTestsBySubject(\'all\')">All Subjects</a>';
            testSubjectMenu.appendChild(allTestOption);
            
            // Add divider
            const testDivider = document.createElement('li');
            testDivider.innerHTML = '<hr class="dropdown-divider">';
            testSubjectMenu.appendChild(testDivider);
            
            // Add subjects
            testSubjects.forEach(subject => {
                const item = document.createElement('li');
                item.innerHTML = `<a class="dropdown-item" href="#" onclick="filterTestsBySubject('${subject}')">${subject}</a>`;
                testSubjectMenu.appendChild(item);
            });
        }

        // Chart functions
        function initCharts() {
            // Performance chart (average grades over time)
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            
            // Group test results by month and calculate average
            const monthlyAverages = {};
            testRecords.forEach(record => {
                const date = new Date(record.date);
                const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                
                if (!monthlyAverages[monthYear]) {
                    monthlyAverages[monthYear] = {
                        total: 0,
                        count: 0
                    };
                }
                
                monthlyAverages[monthYear].total += parseInt(record.score);
                monthlyAverages[monthYear].count++;
            });
            
            const months = Object.keys(monthlyAverages).sort();
            const averages = months.map(month => 
                (monthlyAverages[month].total / monthlyAverages[month].count).toFixed(1)
            );
            
            new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Average Test Score',
                        data: averages,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Average Test Scores Over Time'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
            
            // Subject comparison chart (average by subject)
            const subjectComparisonCtx = document.getElementById('subjectComparisonChart').getContext('2d');
            
            const subjectAverages = {};
            testRecords.forEach(record => {
                if (!subjectAverages[record.subject]) {
                    subjectAverages[record.subject] = {
                        total: 0,
                        count: 0
                    };
                }
                
                subjectAverages[record.subject].total += parseInt(record.score);
                subjectAverages[record.subject].count++;
            });
            
            const subjects = Object.keys(subjectAverages);
            const subjectAvgs = subjects.map(subject => 
                (subjectAverages[subject].total / subjectAverages[subject].count).toFixed(1)
            );
            
            // Generate random colors for each subject
            const backgroundColors = subjects.map(() => 
                `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.7)`
            );
            
            new Chart(subjectComparisonCtx, {
                type: 'bar',
                data: {
                    labels: subjects,
                    datasets: [{
                        label: 'Average Score',
                        data: subjectAvgs,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors.map(color => color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Average Scores by Subject'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>